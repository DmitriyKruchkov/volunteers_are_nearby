stages:
  - linting
  - testing
  - documentation
  - deploy
  - notify

before_script:
  - poetry shell
  - poetry install

linting:
  stage: linting
  script:
    - ruff check --fix
  artifacts:
    paths:
      - flaskr/

testing:
  stage: testing
  script:
    - pytest

documentation:
  stage: documentation
  script:
    - cd docs
    - python3 create_all_docs.py
  artifacts:
    paths:
      - $CI_PROJECT_DIR/docs/
  rules:
    - allow_failure: true


deploy:
  stage: deploy
  script:
    - docker-compose down
    - docker-compose up -d
    #  only:
    # - master

notify:
  stage: notify
  script:
    - sh ci-notify.sh $CI_JOB_STATUS
  when: always